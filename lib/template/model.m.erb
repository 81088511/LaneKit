//
//  <%=@model_file_name%>.m
//
//  This model was created on <%=@model_date%> by LaneKit v<%=@lanekit_version%>.
//

#import "<%=@model_file_name%>.h"
#import "RestKit.h"<% @attributes.each do |attribute| %><% if attribute[:relationship] %>
#import "<%=attribute[:relationship]%>.h"<%end%><%end%>

@implementation <%=@class_name%><% if @using_core_data %>

// All properties in this NSManagedObject need to be defined with @dynamic<% @attributes.each do |attribute| %>
@dynamic <%=attribute[:name]%>;<% end %><% end %>

+ (void)initialize
{
  if (self == [<%=@class_name%> class])
  {
  }
}<% if @using_core_data %>

+ (NSString *)entityName
{
    return NSStringFromClass([self class]);
}

+ (<%=@class_name%> *)create:(NSManagedObjectContext *)moc
{
    <%=@class_name%> *entity = nil;
    @try {
        entity = [NSEntityDescription insertNewObjectForEntityForName:self.entityName inManagedObjectContext:moc];
    }
    @catch (NSException *exception) {
        NSLog(@"[%@ %@] %@", [self description], NSStringFromSelector(_cmd), exception);
        @throw exception;
    }
    return entity;
}<% end %>

+ (NSDictionary *)dictionaryForMappings
{
    return @{
<% @attributes.each_with_index do |attribute, index| %><% if !attribute[:relationship] %>        @"<%=attribute[:name]%>": @"<%=attribute[:name]%>"<% if index != @attributes.size-1 %>,<% end %>
<% end %><% end %>    };
}

+ (NSString *)keyPath
{
  return @"<%=@model_name%>";
}

+ (NSString *)pathPattern
{
  return nil;
}

+ (RKObjectMapping *)requestMapping
{
    RKObjectMapping *requestMapping = [RKObjectMapping requestMapping];
    [requestMapping addAttributeMappingsFromDictionary:[self dictionaryForMappings]];
    return requestMapping;
}

+ (RKObjectMapping *)responseMapping
{
    RKObjectMapping *mapping = [RKObjectMapping mappingForClass:[<%=@class_name%> class]];
    [mapping addAttributeMappingsFromDictionary:[self dictionaryForMappings]];
<% @attributes.each_with_index do |attribute, index| %><% if attribute[:relationship] %>
    [mapping addRelationshipMappingWithSourceKeyPath:@"<%=attribute[:name]%>" mapping:[<%=attribute[:relationship]%> modelMapping]];
<% end %><% end %>    return mapping;
}

@end
