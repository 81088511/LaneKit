//
//  <%=@file_name%>.m
//
//  This model was created on <%=@model_date%> by LaneKit v<%=@lanekit_version%>.
//
//

#import "<%=@file_name%>.h"
#import "MobileCoreServices/MobileCoreServices.h"
#import "SystemConfiguration/SystemConfiguration.h"
#import "RestKit.h"
<% @attributes.each do |attribute| %><% if attribute[:relationship] %>#import "<%=attribute[:relationship]%>.h"<%end%><%end%>

@implementation <%=@class_name%>

+ (void)initialize
{
  if (self == [<%=@class_name%> class])
  {
  }
}

+ (NSDictionary *)dictionaryForMappings
{
    return @{
<% @attributes.each_with_index do |attribute, index| %><% if !attribute[:relationship] %>        @"<%=attribute[:name]%>": @"<%=attribute[:name]%>"<% if index != @attributes.size-1 %>,<% end %>
<% end %><% end %>    };
}

// Returns the request RKObjectMapping
+ (RKObjectMapping *)requestMapping
{
    RKObjectMapping *requestMapping = [RKObjectMapping requestMapping];
    [requestMapping addAttributeMappingsFromDictionary:[self dictionaryForMappings]];
    return requestMapping;
}

// Returns the response RKObjectMapping
+ (RKObjectMapping *)responseMapping
{
    RKObjectMapping *mapping = [RKObjectMapping mappingForClass:[<%=@class_name%> class]];
    [mapping addAttributeMappingsFromDictionary:[self dictionaryForMappings]];
<% @attributes.each_with_index do |attribute, index| %><% if attribute[:relationship] %>
    [mapping addRelationshipMappingWithSourceKeyPath:@"<%=attribute[:name]%>" mapping:[<%=attribute[:relationship]%> modelMapping]];
<% end %><% end %>    return mapping;
}

@end

#pragma mark SenTestingKit test cases

#if defined(SEN_TESTING)
@implementation <%=@class_name%>Testing

- (void)testMapping
{
    RKObjectMapping *requestMapping = [<%=@class_name%> requestMapping];
    STAssertNotNil(requestMapping, @"[<%=@class_name%> requestMapping] returned nil.");

    RKObjectMapping *responseMapping = [<%=@class_name%> responseMapping];
    STAssertNotNil(responseMapping, @"[<%=@class_name%> responseMapping] returned nil.");

    <%=@class_name%> *<%=@model_name%> = <%=@class_name%>.new;
    STAssertNotNil(<%=@model_name%>, @"<%=@class_name%>.new returned nil.");
<% @attributes.each_with_index do |attribute, index| %><% if !attribute[:relationship] %>
    <%=@model_name%>.<%=attribute[:name]%> = @"value";
    STAssertTrue([<%=@model_name%>.<%=attribute[:name]%> isEqualToString:@"value"], @"<%=@model_name%>.<%=attribute[:name]%> has incorrect value.");<% end %><% end %>
}

@end
#endif
